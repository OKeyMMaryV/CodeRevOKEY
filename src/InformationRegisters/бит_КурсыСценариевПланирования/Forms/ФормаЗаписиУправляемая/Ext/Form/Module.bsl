
#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если ТипЗнч(ЭтаФорма.ВладелецФормы) = Тип("УправляемаяФорма") И ЭтаФорма.ВладелецФормы.Имя = "СписокКурсыСценариевПланирования" Тогда
		Элементы.Сценарий.ТолькоПросмотр = Истина;
		Элементы.Валюта.ТолькоПросмотр   = Истина;
	КонецЕсли;
	
КонецПроцедуры // ПриОткрытии()

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	МетаданныеОбъекта = Метаданные.РегистрыСведений.бит_КурсыСценариевПланирования;
	
	// Вызов механизма защиты
	
	
	бит_РаботаСДиалогамиСервер.ФормаЗаписиРегистраПриСозданииНаСервере(Отказ, СтандартнаяОбработка, ЭтотОбъект);

	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Параметры.ЗначенияЗаполнения) Тогда
		
		Элементы.Сценарий.ТолькоПросмотр = Истина;
		
		// Если это новая запись и валюта заполнена - получим курс и кратность.
		Если ЗначениеЗаполнено(Запись.Валюта) И ЗначениеЗаполнено(Запись.Сценарий) 
			И Не ЗначениеЗаполнено(Параметры.ЗначениеКопирования) Тогда
			
			СтруктураОтбора = Новый Структура("Сценарий, Валюта", Запись.Сценарий, Запись.Валюта);
			СтруктураКурса  = РегистрыСведений.бит_КурсыСценариевПланирования.ПолучитьПоследнее(ТекущаяДата(), СтруктураОтбора);
            		
			Запись.Курс      = ?(СтруктураКурса.Курс = 0	 , 1, СтруктураКурса.Курс);
			Запись.Кратность = ?(СтруктураКурса.Кратность = 0, 1, СтруктураКурса.Кратность);
			
		КонецЕсли;

	КонецЕсли;
	
КонецПроцедуры // ПриСозданииНаСервере()

#КонецОбласти

