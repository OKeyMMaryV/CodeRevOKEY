
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// СтандартныеПодсистемы.ВерсионированиеОбъектов
	ВерсионированиеОбъектов.ПриСозданииНаСервере(ЭтотОбъект);
	// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов
	
	// Стандартные действия при создании на сервере.
	бит_РаботаСДиалогамиСервер.ФормаОбъектаПриСозданииНаСервере(Отказ, СтандартнаяОбработка, ЭтаФорма, Объект);

	Элементы.Владелец.ТолькоПросмотр = ЗначениеЗаполнено(Объект.Владелец);
	
	ЭлементУО = УсловноеОформление.Элементы.Добавить();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура КоэффициентПриИзменении(Элемент)
	
	УстановитьКоэффициентУПодчиненных();

КонецПроцедуры

&НаКлиенте
Процедура СтатьяОборотовПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(Объект.СтатьяОборотов) Тогда
		
		ЗаполнитьРеквизитыПоДаннымСтатьиОборотов();
				
	КонецЕсли; 

КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьКоэффициентУПодчиненных()

	Если НЕ ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Возврат;
	КонецЕсли; 
	
	Выборка = Справочники.бит_СтатьиБюджета.ВыбратьИерархически(Объект.Ссылка, Объект.Владелец);
	Пока Выборка.Следующий() Цикл
		
		СпрОбъект = Выборка.Ссылка.ПолучитьОбъект();
		
		Если Объект.Коэффициент = 0 Тогда
			СпрОбъект.Коэффициент = ?(СпрОбъект.СтатьяОборотов.РасходДоход = Перечисления.бит_РасходДоход.Расходование, -1, 1);
		Иначе	
			СпрОбъект.Коэффициент = Объект.Коэффициент;
		КонецЕсли;
		
		бит_ОбщегоНазначения.ЗаписатьСправочник(СпрОбъект, , "Ошибки");
		
	КонецЦикла; 
	
КонецПроцедуры // УстановитьКоэффициентУПодчиненных()

&НаСервере
Процедура ЗаполнитьРеквизитыПоДаннымСтатьиОборотов()

	Объект.Наименование 	  = Объект.СтатьяОборотов.Наименование;
	Объект.Кодификатор 	      = Объект.СтатьяОборотов.Кодификатор;
	
	Если Объект.Коэффициент = 0 Тогда
		Объект.Коэффициент = 1;
	КонецЕсли; 
     
КонецПроцедуры // ЗаполнитьРеквизитыПоДаннымСтатьиОборотов()

#КонецОбласти

