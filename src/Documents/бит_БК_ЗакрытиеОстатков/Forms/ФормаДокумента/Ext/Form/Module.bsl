
//   действия с суммами 
&НаКлиенте
Процедура ТабличнаяЧасть1СуммаСНДСПриИзменении(Элемент)
	ПересчитатьСуммыВТЧ_Вызов_Функции("СуммаСНДС",Элементы.ТабличнаяЧасть1.ТекущиеДанные.ПолучитьИдентификатор());
	//ОКЕЙ Рычаков А.С. (СофтЛаб) Начало 2019-09-24 (#3492)
	ОбновитьПризнакОтрицательныхОстатков();
	//ОКЕЙ Рычаков А.С. (СофтЛаб) Конец 2019-09-24 (#3492)
КонецПроцедуры
&НаКлиенте
Процедура ТабличнаяЧасть1СтавкаНДСПриИзменении(Элемент)
	ПересчитатьСуммыВТЧ_Вызов_Функции("СтавкаНДС",Элементы.ТабличнаяЧасть1.ТекущиеДанные.ПолучитьИдентификатор());
КонецПроцедуры
&НаКлиенте
Процедура ТабличнаяЧасть1СуммаПриИзменении(Элемент)
	ПересчитатьСуммыВТЧ_Вызов_Функции("СуммаБезНДС",Элементы.ТабличнаяЧасть1.ТекущиеДанные.ПолучитьИдентификатор());
	//ОКЕЙ Рычаков А.С. (СофтЛаб) Начало 2019-09-24 (#3492)
	ОбновитьПризнакОтрицательныхОстатков();
	//ОКЕЙ Рычаков А.С. (СофтЛаб) Конец 2019-09-24 (#3492)
КонецПроцедуры

&НаСервере
Функция ПересчитатьСуммыВТЧ_Вызов_Функции(ТочкаВхода, ИдентификаторСтроки)
	ТекущаяСтрока = Объект.ТабличнаяЧасть.НайтиПоИдентификатору(ИдентификаторСтроки);
	_объект=РеквизитФормыВЗначение("Объект");
	_объект.ПересчитатьСуммыВТЧ(ТочкаВхода, ТекущаяСтрока);
	//ЗначениеВРеквизитФормы(_объект, "Объект");
КонецФункции

//ОКЕЙ Рычаков А.С. (СофтЛаб) Начало 2019-09-24 (#3492)
&НаКлиенте
Процедура ОбновитьПризнакОтрицательныхОстатков()
	
	ТекущиеДанные = Элементы.ТабличнаяЧасть1.ТекущиеДанные;
	
	Если ТекущиеДанные.СуммаБезНДС < 0 Тогда
		Объект.ок_ОтрицательныеОстатки = Истина;
	Иначе
		
		Объект.ок_ОтрицательныеОстатки = Ложь;
		
		Для Каждого ТекущаяСтрока Из Объект.ТабличнаяЧасть Цикл 
			
			Если ТекущаяСтрока.СуммаБезНДС < 0 Тогда
				Объект.ок_ОтрицательныеОстатки = Истина;
				Прервать;
			КонецЕсли;
			
		КонецЦикла;	
		
	КонецЕсли;	
	
КонецПроцедуры
//ОКЕЙ Рычаков А.С. (СофтЛаб) Конец 2019-09-24 (#3492)

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Объект.Комментарий = "_*_ОтказПриОткрытии_*_" Тогда
		Отказ = Истина; 		
	КонецЕсли;
	//+Сундукова 31.05.2016 №2491
	УстановитьВидимость();
	//-Сундукова 31.05.2016 №2491
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	ОбщегоНазначенияБПКлиент.ОбработкаОповещенияФормыДокумента(ЭтотОбъект, Объект.Ссылка, ИмяСобытия, Параметр, Источник);
КонецПроцедуры

//+Сундукова 31.05.2016 доступность убирается только у проведенного 2491
//+Сундукова 01.04.2016 убираем доступность из полей заявка 2053
//&НаКлиенте
//Процедура ПриОткрытии(Отказ)
//этаформа.Элементы.ТабличнаяЧасть1Организация.ТолькоПросмотр = истина;	
//этаформа.Элементы.ТабличнаяЧасть1Период.ТолькоПросмотр = ложь;
//этаформа.Элементы.ТабличнаяЧасть1Функция.ТолькоПросмотр = истина;
//этаформа.Элементы.ТабличнаяЧасть1Статья.ТолькоПросмотр = истина;
//этаформа.Элементы.ТабличнаяЧасть1Объект.ТолькоПросмотр = истина;
//этаформа.Элементы.ТабличнаяЧасть1НомерЗаявки.ТолькоПросмотр = истина;
//этаформа.Элементы.ТабличнаяЧасть1Сценарий.ТолькоПросмотр = истина;
//этаформа.Элементы.ТабличнаяЧасть1Проект.ТолькоПросмотр = истина;

//КонецПроцедуры
//-Сундукова 01.04.2016 убираем доступность из полей
//-Сундукова 31.05.2016 доступность убирается только у проведенного 2491

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	//+Сундукова 31.05.2016 №2491
	УстановитьВидимость();
	//-Сундукова 31.05.2016 №2491
КонецПроцедуры

//+Сундукова 31.05.2016 №2491
Процедура УстановитьВидимость()
ЭтаФорма.Элементы.ТабличнаяЧасть1.ТолькоПросмотр = объект.Проведен;	
КонецПроцедуры
//-Сундукова 31.05.2016 №2491

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	//{ bit SVKushnirenko Bit 27.01.2017 #2657
	пМассивОбновления = ПолучитьМассивЗаявокКоторыеМогутИзменитьСтатусПриДвижениях(Объект.Ссылка);
	Если рекМассивДокументовОповещенияДляИзмененияСтатуса.Количество() <>  0 Тогда
		
		Для каждого пСтрокаДанных Из рекМассивДокументовОповещенияДляИзмененияСтатуса Цикл
			
			пМассивОбновления.Добавить(пСтрокаДанных.Значение);
		КонецЦикла; 
	КонецЕсли;
	 
	Если пМассивОбновления.Количество()  >  0 Тогда
		
		Оповестить("бит_БК_ИзмСтатусаПослеИзмБалансаЗаявок", Новый Структура("Ссылки", пМассивОбновления));
	КонецЕсли;
	//} bit SVKushnirenko Bit 27.01.2017 #2657
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)

	//{ bit SVKushnirenko Bit 27.01.2017 #2657
	пМассивОбновления = ПолучитьМассивЗаявокКоторыеМогутИзменитьСтатусПриДвижениях(Объект.Ссылка);
	рекМассивДокументовОповещенияДляИзмененияСтатуса.ЗагрузитьЗначения(пМассивОбновления);
	//} bit SVKushnirenko Bit 27.01.2017 #2657
КонецПроцедуры

//bit_SVKushnirenko 27.01.2017 #2657
//Прокладка для вызова серверного метода из клиента на форме
// Параметры:
//парСсылка - ссылка на текущий документ
&НаСервереБезКонтекста
Функция ПолучитьМассивЗаявокКоторыеМогутИзменитьСтатусПриДвижениях(парСсылка)

	Возврат бит_БК_Общий.ПолучитьМассивЗаявокКоторыеМогутИзменитьСтатусПриДвижениях(парСсылка);
КонецФункции // ПолучитьМассивЗаявокКоторыеМогутИзменитьСтатусПриДвижениях()
//bit_SVKushnirenko 27.01.2017 #2657

