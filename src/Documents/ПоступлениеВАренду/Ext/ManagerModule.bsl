#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

Функция ВремяДокументаПоУмолчанию() Экспорт
	
	Возврат Новый Структура("Часы, Минуты", 7, 0);
	
КонецФункции

Функция СчетаУчетаПредметаАренды(ДанныеОбъекта) Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("СчетУчета", ?(ДанныеОбъекта.ПринятьКУчету Или ДанныеОбъекта.ПереходНаФСБУ25,
		ПланыСчетов.Хозрасчетный.АрендованноеИмущество,
		ПланыСчетов.Хозрасчетный.ПриобретениеОсновныхСредств));
	Результат.Вставить("СчетНачисленияАмортизации", ПланыСчетов.Хозрасчетный.АмортизацияАрендованногоИмущества);
	Результат.Вставить("СчетУчетаНДС", ?(ДанныеОбъекта.РасчетыВУЕ, 
		ПланыСчетов.Хозрасчетный.НДСпоАренднымОбязательствамУЕ,
		ПланыСчетов.Хозрасчетный.НДСпоАренднымОбязательствам));
	
	Возврат Результат;
	
КонецФункции

// Устарела. Используется для старых документов с признаком ЛизингДоФСБУ25.
Процедура ЗаполнитьСчетаУчетаВСтрокеТабличнойЧасти(Объект, СтрокаТаблицы, ИмяТаблицы) Экспорт

	СчетаУчета = БухгалтерскийУчетПереопределяемый.ПолучитьСчетаУчетаНоменклатуры(Объект.Организация,
		СтрокаТаблицы.Номенклатура, Объект.Склад);
		
	СтрокаТаблицы.СчетУчета = СчетаУчета.СчетУчета;
	
	Если Объект.РасчетыВУЕ Тогда
		СтрокаТаблицы.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.НДСпоАренднымОбязательствамУЕ;
	Иначе
		СтрокаТаблицы.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.НДСпоАренднымОбязательствам;
	КонецЕсли;

КонецПроцедуры

// СтандартныеПодсистемы.ВерсионированиеОбъектов

// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
//  Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт

КонецПроцедуры

// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов

// Заполняет список команд печати.
// 
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
	// Справка-расчет "Начисление процентных расходов"
	УчетПроцентовПоОбязательствам.ДобавитьКомандуПечатиНачислениеПроцентныхРасходов(КомандыПечати);
	
	// Справка-расчет "Рублевые суммы документа в валюте"
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.МенеджерПечати = "Обработка.ПечатьРублевыхСуммДокументовВВалюте";
	КомандаПечати.Идентификатор = "РублевыеСуммыДокументаВВалюте";
	КомандаПечати.Представление = НСтр("ru = 'Справка-расчет ""Рублевые суммы документа в валюте""'");
	КомандаПечати.Обработчик    = "УправлениеПечатьюБПКлиент.ВыполнитьКомандуПечати";
	КомандаПечати.ФункциональныеОпции = "ИспользоватьВалютныйУчет";
	
	// Реестр документов
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.Идентификатор = "Реестр";
	КомандаПечати.Представление = НСтр("ru = 'Реестр документов'");
	КомандаПечати.ЗаголовокФормы= НСтр("ru = 'Реестр документов ""Поступление в аренду (лизинг)""'");
	КомандаПечати.Обработчик    = "УправлениеПечатьюБПКлиент.ВыполнитьКомандуПечатиРеестраДокументов";
	КомандаПечати.СписокФорм    = "ФормаСписка";
	КомандаПечати.Порядок       = 100;
	
КонецПроцедуры

Функция ПодготовитьТекстЗапросаДляПечатиСправкиРасчетаРублевыеСуммыДокументовВВалюте(НомераТаблиц) Экспорт
	
	НомераТаблиц.Вставить("ВТ_Реквизиты",                   НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаРеквизитов",              НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ВТ_РублевыеСуммые",              НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ВТ_ЗачтенныеАвансы",             НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаПредоплат",               НомераТаблиц.Количество());
	НомераТаблиц.Вставить("Уничтожение_ВТ_ЗачтенныеАвансы", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("Уничтожение_ВТ_Реквизиты",       НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаСумм",                    НомераТаблиц.Количество());
	НомераТаблиц.Вставить("Уничтожение_РублевыеСуммы",      НомераТаблиц.Количество());
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Ссылка,
	|	Реквизиты.Дата КАК Дата,
	|	Реквизиты.Проведен КАК Проведен,
	|	Реквизиты.ВалютаДокумента КАК ВалютаДокумента,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.Контрагент КАК Контрагент,
	|	Реквизиты.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	Реквизиты.СчетУчетаРасчетовСКонтрагентом КАК СчетУчетаРасчетовСКонтрагентом,
	|	Реквизиты.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	|	Реквизиты.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	|	"""" КАК НомерВходящегоДокумента,
	|	ДАТАВРЕМЯ(1, 1, 1) КАК ДатаВходящегоДокумента,
	|	ЕСТЬNULL(Реквизиты.ДоговорКонтрагента.РасчетыВУсловныхЕдиницах, ЛОЖЬ) КАК РасчетыВУсловныхЕдиницах,
	|	ЕСТЬNULL(Реквизиты.ДоговорКонтрагента.УчетАгентскогоНДС, ЛОЖЬ) КАК УчетАгентскогоНДС,
	|	ЛОЖЬ КАК ЭлектронныеУслуги,
	|	Реквизиты.СуммаВключаетНДС КАК СуммаВключаетНДС
	|ПОМЕСТИТЬ Реквизиты
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка В(&МассивОбъектов)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Ссылка,
	|	Реквизиты.Дата КАК Дата,
	|	Реквизиты.Проведен КАК Проведен,
	|	Реквизиты.ВалютаДокумента КАК ВалютаДокумента,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.Контрагент КАК Контрагент,
	|	Реквизиты.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	Реквизиты.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	|	Реквизиты.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	|	Реквизиты.НомерВходящегоДокумента КАК НомерВходящегоДокумента,
	|	Реквизиты.ДатаВходящегоДокумента КАК ДатаВходящегоДокумента,
	|	Реквизиты.РасчетыВУсловныхЕдиницах КАК РасчетыВУсловныхЕдиницах,
	|	Реквизиты.УчетАгентскогоНДС КАК УчетАгентскогоНДС,
	|	Реквизиты.ЭлектронныеУслуги КАК ЭлектронныеУслуги,
	|	Реквизиты.СуммаВключаетНДС КАК СуммаВключаетНДС,
	|	0 КАК ВсегоВал,
	|	0 КАК НДСВал
	|ИЗ
	|	Реквизиты КАК Реквизиты
	|
	|УПОРЯДОЧИТЬ ПО
	|	Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РублевыеСуммы.Регистратор КАК Регистратор,
	|	РублевыеСуммы.ТабличнаяЧастьДокумента КАК ТабличнаяЧастьДокумента,
	|	РублевыеСуммы.НомерСтрокиДокумента КАК НомерСтрокиДокумента,
	|	РублевыеСуммы.Всего КАК Всего,
	|	РублевыеСуммы.НДС КАК НДС,
	|	РублевыеСуммы.НалоговаяБазаНДС КАК НалоговаяБазаНДС
	|ПОМЕСТИТЬ РублевыеСуммы
	|ИЗ
	|	РегистрСведений.РублевыеСуммыДокументовВВалюте КАК РублевыеСуммы
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Реквизиты КАК Реквизиты
	|		ПО РублевыеСуммы.Регистратор = Реквизиты.Ссылка
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор,
	|	ТабличнаяЧастьДокумента,
	|	НомерСтрокиДокумента
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Хозрасчетный.Регистратор КАК Ссылка,
	|	Хозрасчетный.Сумма КАК СуммаПредоплатыРуб,
	|	Хозрасчетный.ВалютнаяСуммаДт КАК СуммаПредоплатыВал,
	|	ХозрасчетныйСубконто.Значение КАК Документ,
	|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйСубконто.Значение) КАК ДокументПредоплатыПредставление,
	|	Реквизиты.Организация КАК Организация
	|ПОМЕСТИТЬ ЗачтенныеАвансы
	|ИЗ
	|	РегистрБухгалтерии.Хозрасчетный КАК Хозрасчетный
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Реквизиты КАК Реквизиты
	|		ПО Хозрасчетный.Регистратор = Реквизиты.Ссылка
	|			И Хозрасчетный.СчетДт = Реквизиты.СчетУчетаРасчетовСКонтрагентом
	|			И (Реквизиты.ВалютаДокумента <> &ВалютаРегламентированногоУчета)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Хозрасчетный.Субконто КАК ХозрасчетныйСубконто
	|		ПО Хозрасчетный.Регистратор = ХозрасчетныйСубконто.Регистратор
	|			И Хозрасчетный.НомерСтроки = ХозрасчетныйСубконто.НомерСтроки
	|			И (ХозрасчетныйСубконто.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияБухгалтерии.Кредит))
	|			И (ХозрасчетныйСубконто.Вид = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ДокументыРасчетовСКонтрагентами))
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Документ,
	|	Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗачтенныеАвансы.Ссылка КАК Ссылка,
	|	ЗачтенныеАвансы.СуммаПредоплатыРуб КАК СуммаПредоплатыРуб,
	|	ЗачтенныеАвансы.СуммаПредоплатыВал КАК СуммаПредоплатыВал,
	|	ЗачтенныеАвансы.Документ КАК Документ,
	|	ЗачтенныеАвансы.ДокументПредоплатыПредставление КАК ДокументПредоплатыПредставление,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.Номер, """") КАК НомерВходящегоДокумента,
	|	ЕСТЬNULL(ДанныеПервичныхДокументов.Дата, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаВходящегоДокумента
	|ИЗ
	|	ЗачтенныеАвансы КАК ЗачтенныеАвансы
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|		ПО ЗачтенныеАвансы.Организация = ДанныеПервичныхДокументов.Организация
	|			И ЗачтенныеАвансы.Документ = ДанныеПервичныхДокументов.Документ
	|
	|УПОРЯДОЧИТЬ ПО
	|	ЗачтенныеАвансы.Ссылка
	|ИТОГИ
	|	СУММА(СуммаПредоплатыРуб),
	|	СУММА(СуммаПредоплатыВал)
	|ПО
	|	Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ЗачтенныеАвансы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ Реквизиты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыЛизинга.Ссылка КАК Ссылка,
	|	ПредметыЛизинга.НомерСтроки КАК НомерСтроки,
	|	ПредметыЛизинга.Номенклатура КАК Товар,
	|	ПредметыЛизинга.Номенклатура.Наименование КАК ТоварНаименование,
	|	ПредметыЛизинга.Сумма КАК ВсегоВал,
	|	ПредметыЛизинга.СуммаНДС КАК НДСВал,
	|	ПредметыЛизинга.СтавкаНДС КАК СтавкаНДС,
	|	РублевыеСуммы.Всего КАК ВсегоРуб,
	|	РублевыеСуммы.НДС КАК НДСРуб,
	|	РублевыеСуммы.НалоговаяБазаНДС КАК НалоговаяБазаНДСРуб
	|ИЗ
	|	Документ.ПоступлениеВАренду.ПредметыЛизинга КАК ПредметыЛизинга
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РублевыеСуммы КАК РублевыеСуммы
	|		ПО ПредметыЛизинга.Ссылка = РублевыеСуммы.Регистратор
	|			И (РублевыеСуммы.ТабличнаяЧастьДокумента = ЗНАЧЕНИЕ(Перечисление.ТабличныеЧастиДокументов.ПредметыЛизинга))
	|			И ПредметыЛизинга.НомерСтроки = РублевыеСуммы.НомерСтрокиДокумента
	|ГДЕ
	|	ПредметыЛизинга.Сумма <> 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка,
	|	ПредметыАренды.НомерСтроки,
	|	ПредметыАренды.ПредметАренды,
	|	ПредметыАренды.ПредметАренды.Наименование,
	|	ПредметыАренды.Сумма,
	|	ПредметыАренды.СуммаНДС,
	|	ПредметыАренды.СтавкаНДС,
	|	РублевыеСуммы.Всего,
	|	РублевыеСуммы.НДС,
	|	РублевыеСуммы.НалоговаяБазаНДС
	|ИЗ
	|	Документ.ПоступлениеВАренду.ПредметыАренды КАК ПредметыАренды
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РублевыеСуммы КАК РублевыеСуммы
	|		ПО ПредметыАренды.Ссылка = РублевыеСуммы.Регистратор
	|			И (РублевыеСуммы.ТабличнаяЧастьДокумента = ЗНАЧЕНИЕ(Перечисление.ТабличныеЧастиДокументов.ПредметыАренды))
	|			И ПредметыАренды.НомерСтроки = РублевыеСуммы.НомерСтрокиДокумента
	|ГДЕ
	|	ПредметыАренды.Сумма <> 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Ссылка,
	|	НомерСтроки
	|ИТОГИ
	|	СУММА(ВсегоВал),
	|	СУММА(НДСВал),
	|	СУММА(ВсегоРуб),
	|	СУММА(НДСРуб),
	|	СУММА(НалоговаяБазаНДСРуб)
	|ПО
	|	Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ РублевыеСуммы";
	
	Возврат ТекстЗапроса;
	
КонецФункции	

Функция ПолучитьДополнительныеРеквизитыДляРеестра() Экспорт
	
	Результат = Новый Структура("Информация", "Контрагент");
	
	Возврат Результат;
	
КонецФункции

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Организация)";

КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецОбласти

#Область ОбработчикиСобытий

Процедура ОбработкаПолученияФормы(ВидФормы, Параметры, ВыбраннаяФорма, ДополнительнаяИнформация, СтандартнаяОбработка)
	
	Если ВидФормы <> "ФормаОбъекта" Тогда
		Возврат;
	КонецЕсли;
	
	Если Параметры.Свойство("Ключ") И ЗначениеЗаполнено(Параметры.Ключ) Тогда
		
		Реквизиты = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Параметры.Ключ, "ЛизингДоФСБУ25,ВидОперации,СпособОценкиАрендыБУ");
		Если Реквизиты.ЛизингДоФСБУ25 = Истина // Может быть Неопределено
			Или Реквизиты.ВидОперации = Перечисления.ВидыОперацийПоступлениеВАренду.ПустаяСсылка()
			И Реквизиты.СпособОценкиАрендыБУ = Перечисления.СпособыОценкиБУ.ПустаяСсылка() Тогда
			СтандартнаяОбработка = Ложь;
			ВыбраннаяФорма = "ФормаДокументаЛизингДоФСБУ25";
		КонецЕсли;
		Возврат;
		
	КонецЕсли;
		
	Если Параметры.Свойство("ЗначениеКопирования") И ЗначениеЗаполнено(Параметры.ЗначениеКопирования) Тогда
		Возврат;
	КонецЕсли;
	
	Если Не Параметры.Свойство("ЗначенияЗаполнения") Тогда
		Параметры.Вставить("ЗначенияЗаполнения", Новый Структура);
	КонецЕсли;
	
	ЕстьСвойствоВидОперации = Параметры.ЗначенияЗаполнения.Свойство("ВидОперации");
	Если ЕстьСвойствоВидОперации Тогда
		Возврат;
	КонецЕсли;
	
	ЕстьЛизинг = ПолучитьФункциональнуюОпцию("ВедетсяУчетЛизинговогоИмущества");
	ЕстьАренда = ПолучитьФункциональнуюОпцию("ВедетсяУчетПредметовАренды");
	Если ЕстьЛизинг И ЕстьАренда Тогда // Просим пользователя выбрать вид операции
		СтандартнаяОбработка = Ложь;
		ВыбраннаяФорма = "ВыборОперации";
	Иначе
		ВидОперации = ?(ЕстьЛизинг,
			Перечисления.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг,
			Перечисления.ВидыОперацийПоступлениеВАренду.ПоступлениеВАренду);
		Параметры.ЗначенияЗаполнения.Вставить("ВидОперации", ВидОперации); 
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

#Область ОбработчикиОбновленияИБ

Процедура УстановитьСозданДоФСБУ25(Параметры) Экспорт

	Запрос = Новый Запрос(
		"ВЫБРАТЬ РАЗЛИЧНЫЕ ПЕРВЫЕ 1000
		|	ПоступлениеВАрендуПредметыЛизинга.Ссылка КАК Ссылка
		|ИЗ
		|	Документ.ПоступлениеВАренду.ПредметыЛизинга КАК ПоступлениеВАрендуПредметыЛизинга
		|ГДЕ
		|	НЕ ПоступлениеВАрендуПредметыЛизинга.Ссылка.ЛизингДоФСБУ25");
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Количество() = 0 Тогда
		Параметры.ОбработкаЗавершена = Истина;
		Возврат;
	КонецЕсли;
	
	Параметры.ОбработкаЗавершена = Ложь;
	
	ПроблемныхОбъектов = 0;
	ОбъектовОбработано = 0;
	
	Пока Выборка.Следующий() Цикл
		
		Попытка
			
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			Если ДокументОбъект = Неопределено Тогда
				Продолжить;
			КонецЕсли;
			
			ДокументОбъект.ЛизингДоФСБУ25 = Истина;
			ДокументОбъект.ВидОперации = Перечисления.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг;
			ДокументОбъект.НалоговыйУчетИмуществаВедетЛизингополучатель = Истина;
			ДокументОбъект.СпособОценкиАрендыБУ = Перечисления.СпособыОценкиБУ.РавнаСуммеДоговора;
			
			ОбновлениеИнформационнойБазы.ЗаписатьДанные(ДокументОбъект);
			ОбъектовОбработано = ОбъектовОбработано + 1;
			
		Исключение
			
			ПроблемныхОбъектов = ПроблемныхОбъектов + 1;
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Не удалось обработать документ %1 по причине:
					|%2'"),
					Выборка.Ссылка, ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
			ЗаписьЖурналаРегистрации(ОбновлениеИнформационнойБазы.СобытиеЖурналаРегистрации(), 
				УровеньЖурналаРегистрации.Предупреждение,
				Метаданные.Документы.ПоступлениеВАренду, 
				Выборка.Ссылка, 
				ТекстСообщения);
				
		КонецПопытки;
		
	КонецЦикла;
	
	Если ОбъектовОбработано = 0 Тогда
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Процедуре Документы.ПоступлениеВАренду.УстановитьСозданДоФСБУ25
				|не удалось обработать документы: %1'"),
				ПроблемныхОбъектов);
		ВызватьИсключение ТекстСообщения;
	Иначе
		ЗаписьЖурналаРегистрации(ОбновлениеИнформационнойБазы.СобытиеЖурналаРегистрации(), 
			УровеньЖурналаРегистрации.Информация,
			Метаданные.Документы.ПоступлениеВАренду,
			,
			СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Процедура Документы.ПоступлениеВАренду.УстановитьСозданДоФСБУ25
					|обработала очередную порцию документов: %1'"), ОбъектовОбработано));
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПодготовитьПараметрыПроведения(ДокументСсылка, Отказ) Экспорт

	ПараметрыПроведения = Новый Структура;
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("Ссылка", ДокументСсылка);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Реквизиты.Дата КАК Период,
	|	Реквизиты.Организация,
	|	Реквизиты.ВалютаДокумента,
	|	Реквизиты.ДоговорКонтрагента.ВидДоговора КАК ВидДоговора,
	|	Реквизиты.ДоговорКонтрагента.РасчетыВУсловныхЕдиницах КАК РасчетыВУсловныхЕдиницах,
	|	Реквизиты.ДоговорКонтрагента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Реквизиты.Ссылка,
	|	Реквизиты.СуммаВключаетНДС,
	|	Реквизиты.НДСВключенВСтоимость,
	|	Реквизиты.ДоговорКонтрагента,
	|	Реквизиты.КурсВзаиморасчетов,
	|	Реквизиты.КратностьВзаиморасчетов,
	|	Реквизиты.СпособОценкиАрендыБУ,
	|	Реквизиты.ВидОперации,
	|	Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель,
	|	Реквизиты.ПереходНаФСБУ25,
	|	Реквизиты.СтоимостьОбязательства,
	|	Реквизиты.АвансовыеПлатежи
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка";
	
	ТаблицаРеквизиты = Запрос.Выполнить().Выгрузить();
	
	Реквизиты = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(ТаблицаРеквизиты[0]);
	
	Если НЕ УчетнаяПолитика.Существует(Реквизиты.Организация, Реквизиты.Период, Истина, ДокументСсылка) Тогда
		Отказ = Истина;
		Возврат ПараметрыПроведения;
	КонецЕсли;
	
	Реквизиты.Вставить("ВалютаРеглУчета", ОбщегоНазначенияБПВызовСервераПовтИсп.ПолучитьВалютуРегламентированногоУчета());
	
	Если Реквизиты.ВалютаВзаиморасчетов = Реквизиты.ВалютаРеглУчета Тогда
		Реквизиты.Вставить("КурсДокумента", 1);
		Реквизиты.Вставить("КратностьДокумента", 1);
		КоэффициентРуб = 1;
	Иначе
		Реквизиты.Вставить("КурсДокумента", Реквизиты.КурсВзаиморасчетов);
		Реквизиты.Вставить("КратностьДокумента", Реквизиты.КратностьВзаиморасчетов);
		КоэффициентРуб = Реквизиты.КурсВзаиморасчетов / Реквизиты.КратностьВзаиморасчетов;
	КонецЕсли;
	
	Если Реквизиты.ВалютаВзаиморасчетов = Реквизиты.ВалютаДокумента Тогда
		Реквизиты.Вставить("КурсВзаиморасчетов", 1);
		Реквизиты.Вставить("КратностьВзаиморасчетов", 1);
		КоэффициентВзаиморасчетов = 1;
	Иначе
		Реквизиты.Вставить("КурсВзаиморасчетов", Реквизиты.КурсВзаиморасчетов); 
		Реквизиты.Вставить("КратностьВзаиморасчетов", Реквизиты.КратностьВзаиморасчетов);
		КоэффициентВзаиморасчетов = (Реквизиты.КурсВзаиморасчетов / Реквизиты.КратностьВзаиморасчетов) / КоэффициентРуб;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("КоэффициентВзаиморасчетов", КоэффициентВзаиморасчетов);
	Запрос.УстановитьПараметр("КоэффициентРуб",            КоэффициентРуб);
	Запрос.УстановитьПараметр("ВалютаРеглУчета",           Реквизиты.ВалютаРеглУчета);
	Запрос.УстановитьПараметр("СуммаВключаетНДС",          Реквизиты.СуммаВключаетНДС);
	Запрос.УстановитьПараметр("СобытиеОС", 
		УчетОС.ПолучитьСобытиеПоОСИзСправочника(Перечисления.ВидыСобытийОС.ПринятиеКУчетуСВводомВЭксплуатацию));
	
	ПодготовитьТаблицыДокументаДляЦелейПриобретенияРеализации(Запрос, Реквизиты);
	
	НомераТаблиц = Новый Структура;
	
	Запрос.Текст = ТекстЗапросаВременныеТаблицыДокумента(НомераТаблиц)
		+ ТекстЗапросаЗачетАвансов(ПараметрыПроведения, НомераТаблиц)
		+ ТекстЗапросаТаблицыДокумента(НомераТаблиц)
		+ ТекстЗапросаПоступлениеРеквизиты(НомераТаблиц)
		+ ТекстЗапросаПереоценкаВалютныхОстатков(НомераТаблиц)
		;
		
	Результат = Запрос.ВыполнитьПакет();
	
	Для каждого НомерТаблицы Из НомераТаблиц Цикл
		ПараметрыПроведения.Вставить(НомерТаблицы.Ключ, Результат[НомерТаблицы.Значение].Выгрузить());
	КонецЦикла;
	
	СтруктураТаблицДокумента = Новый Структура;
	СтруктураТаблицДокумента.Вставить("ТаблицаПредметыЛизинга", ПараметрыПроведения.ТаблицаПредметыЛизинга);
	ПараметрыПроведения.Вставить("СтруктураТаблицДокумента", СтруктураТаблицДокумента);
	
	Возврат ПараметрыПроведения;
	
КонецФункции 

Функция ГрафикПроцентовПоАренде(ТаблицаГрафикПлатежей, ТаблицаПредметыАренды, ТаблицаРеквизиты) Экспорт
	
	Результат = Новый Структура;
	УчетПроцентовПоОбязательствам.ЗаполнитьГрафикПроцентов(
		Результат, ТаблицаГрафикПлатежей, ТаблицаПредметыАренды, ТаблицаРеквизиты, "ОсновноеСредство");
	График = ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(Результат, "График");
	
	Возврат График;
	
КонецФункции 

Процедура ДобавитьКолонкуСодержание(ТаблицаЗначений, ТаблицаРеквизиты) Экспорт
	
	Реквизиты = ТаблицаРеквизиты[0];
	
	КодЯзыка = ОбщегоНазначения.КодОсновногоЯзыка();
	
	НомерДокумента = Реквизиты.НомерВходящегоДокумента;
	ДатаДокумента = Формат(Реквизиты.ДатаВходящегоДокумента, НСтр("ru='ДФ=dd.MM.yyyy'", КодЯзыка));
	
	Если Реквизиты.ЛизингДоФСБУ25 Тогда
		Содержание = ?(ЗначениеЗаполнено(НомерДокумента) И ЗначениеЗаполнено(ДатаДокумента),
			СтрШаблон(НСтр("ru='Поступление предмета лизинга по вх.д. %1 от %2'", КодЯзыка), НомерДокумента, ДатаДокумента),
			НСтр("ru='Поступление предмета лизинга'", КодЯзыка));
	ИначеЕсли Реквизиты.ПереходНаФСБУ25 Тогда
		Содержание = НСтр("ru='Переход на ФСБУ 25'", КодЯзыка)
	Иначе
		Содержание = ?(ЗначениеЗаполнено(НомерДокумента) И ЗначениеЗаполнено(ДатаДокумента),
			СтрШаблон(НСтр("ru='Поступление в аренду по вх.д. %1 от %2'", КодЯзыка), НомерДокумента, ДатаДокумента),
			НСтр("ru='Поступление в аренду'", КодЯзыка));
	КонецЕсли;
	
	ТаблицаЗначений.Колонки.Добавить("Содержание", ОбщегоНазначения.ОписаниеТипаСтрока(150));
	ТаблицаЗначений.ЗаполнитьЗначения(Содержание, "Содержание");
	
КонецПроцедуры

Процедура ПодготовитьТаблицыДокументаДляЦелейПриобретенияРеализации(Запрос, Реквизиты)
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ТаблицаПредметыЛизинга.Ссылка КАК Ссылка,
	|	ТаблицаПредметыЛизинга.НомерСтроки КАК НомерСтроки,
	|	ТаблицаПредметыЛизинга.Номенклатура КАК Номенклатура,
	|	ТаблицаПредметыЛизинга.Количество КАК Количество,
	|	ТаблицаПредметыЛизинга.Сумма КАК Сумма,
	|	ТаблицаПредметыЛизинга.СчетУчета КАК СчетУчета,
	|	ТаблицаПредметыЛизинга.СтавкаНДС КАК СтавкаНДС,
	|	ТаблицаПредметыЛизинга.СуммаНДС КАК НДС,
	|	ТаблицаПредметыЛизинга.СчетУчетаНДС КАК СчетУчетаНДС,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыУчетаНДС.Распределен) КАК СпособУчетаНДС
	|ИЗ
	|	Документ.ПоступлениеВАренду.ПредметыЛизинга КАК ТаблицаПредметыЛизинга
	|ГДЕ
	|	ТаблицаПредметыЛизинга.Ссылка = &Ссылка
	|	И ТаблицаПредметыЛизинга.Ссылка.ЛизингДоФСБУ25
	|
	|УПОРЯДОЧИТЬ ПО
	|	ТаблицаПредметыЛизинга.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаПредметыАренды.Ссылка КАК Ссылка,
	|	ТаблицаПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ТаблицаПредметыАренды.ПредметАренды КАК ПредметАренды,
	|	ТаблицаПредметыАренды.Сумма КАК Сумма,
	|	ТаблицаПредметыАренды.РасходыЛизингодателя КАК РасходыЛизингодателя,
	|	ТаблицаПредметыАренды.ОценкаБУ КАК ОценкаБУ,
	|	ТаблицаПредметыАренды.СчетУчета КАК СчетУчета,
	|	ВЫБОР
	|		КОГДА ТаблицаПредметыАренды.Ссылка.ПринятьКУчету
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПриобретениеОсновныхСредств)
	|		ИНАЧЕ ТаблицаПредметыАренды.СчетУчета
	|	КОНЕЦ КАК СчетУчетаВнеоборотногоАктива,
	|	ТаблицаПредметыАренды.СтавкаНДС КАК СтавкаНДС,
	|	ТаблицаПредметыАренды.СуммаНДС КАК НДС,
	|	ТаблицаПредметыАренды.СчетУчетаНДС КАК СчетУчетаНДС,
	|	ТаблицаПредметыАренды.СчетНачисленияАмортизации КАК СчетНачисленияАмортизации,
	|	ТаблицаПредметыАренды.СрокПолезногоИспользования КАК СрокПолезногоИспользования,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыУчетаНДС.Распределен) КАК СпособУчетаНДС
	|ИЗ
	|	Документ.ПоступлениеВАренду.ПредметыАренды КАК ТаблицаПредметыАренды
	|ГДЕ
	|	ТаблицаПредметыАренды.Ссылка = &Ссылка
	|	И НЕ ТаблицаПредметыАренды.Ссылка.ЛизингДоФСБУ25
	|
	|УПОРЯДОЧИТЬ ПО
	|	ТаблицаПредметыАренды.НомерСтроки";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	ТаблицаПредметыЛизинга = РезультатЗапроса[0].Выгрузить();
	УчетВзаиморасчетов.ПодготовкаТаблицыЗначенийДляЦелейПриобретенияИРеализации(ТаблицаПредметыЛизинга, Реквизиты);
	Запрос.УстановитьПараметр("ТаблицаПредметыЛизинга", ТаблицаПредметыЛизинга);
	
	ТаблицаПредметыАренды = РезультатЗапроса[1].Выгрузить();
	УчетВзаиморасчетов.ПодготовкаТаблицыЗначенийДляЦелейПриобретенияИРеализации(ТаблицаПредметыАренды, Реквизиты);
	
	ОтражатьВНУ = Реквизиты.ВидОперации = Перечисления.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг 
		И Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель 
		И Не Реквизиты.ПереходНаФСБУ25
		И УчетнаяПолитика.ПлательщикНалогаНаПрибыль(Реквизиты.Организация, Реквизиты.Период);
		
	РасчетыВВалюте = Реквизиты.ВалютаВзаиморасчетов <> Реквизиты.ВалютаРеглУчета;
	ДокументВВалюте = Реквизиты.ВалютаДокумента <> Реквизиты.ВалютаРеглУчета;
	РассчитыватьСуммыРуб = РасчетыВВалюте И ДокументВВалюте И Реквизиты.КратностьДокумента <> 0;
	РассчитыватьСуммыВал = РасчетыВВалюте И Не ДокументВВалюте И Реквизиты.КурсВзаиморасчетов <> 0;
	Если РассчитыватьСуммыРуб Тогда
		КоэффициентПересчета = Реквизиты.КурсДокумента/Реквизиты.КратностьДокумента;
	ИначеЕсли РассчитыватьСуммыВал Тогда
		КоэффициентПересчета = Реквизиты.КратностьВзаиморасчетов / Реквизиты.КурсВзаиморасчетов;
	Иначе
		КоэффициентПересчета = 1;
	КонецЕсли;
	
	Если ОтражатьВНУ Тогда
		
		МассивРасходыЛизингодателя = ТаблицаПредметыАренды.ВыгрузитьКолонку("РасходыЛизингодателя");
		Если РассчитыватьСуммыРуб Тогда
			РасходыЛизингодателя = ТаблицаПредметыАренды.Итог("РасходыЛизингодателя");
			РасходыЛизингодателяРуб = Окр(РасходыЛизингодателя * КоэффициентПересчета, 2);
			МассивРасходыЛизингодателяРуб = ОбщегоНазначенияБПКлиентСервер.РаспределитьПропорционально(
				РасходыЛизингодателяРуб, МассивРасходыЛизингодателя);
			Если ЗначениеЗаполнено(МассивРасходыЛизингодателяРуб) Тогда
				ТаблицаПредметыАренды.ЗагрузитьКолонку(МассивРасходыЛизингодателяРуб, "СуммаНУ");
			Иначе
				ТаблицаПредметыАренды.ЗаполнитьЗначения(0, "СуммаНУ");
			КонецЕсли;
		Иначе
			ТаблицаПредметыАренды.ЗагрузитьКолонку(МассивРасходыЛизингодателя, "СуммаНУ");
		КонецЕсли;
	Иначе
		ТаблицаПредметыАренды.ЗаполнитьЗначения(0, "СуммаНУ");
	КонецЕсли;
	
	Если Не Реквизиты.НДСВключенВСтоимость Тогда
		Для каждого СтрокаТаблицы Из ТаблицаПредметыАренды Цикл
			СтрокаТаблицы.Сумма = СтрокаТаблицы.СуммаБезНДС;
			СтрокаТаблицы.СуммаВал = СтрокаТаблицы.СуммаБезНДСВал;
			СтрокаТаблицы.СуммаБУ = СтрокаТаблицы.СуммаБУБезНДС;
		КонецЦикла;
	КонецЕсли;
	
	// Обрабатываем колонки дополнительных сумм
	
	ТаблицаПредметыАренды.Колонки.Добавить("СуммаВалБУ", ОбщегоНазначения.ОписаниеТипаЧисло(15, 2));
	МассивСуммаВал = ?(Реквизиты.НДСВключенВСтоимость, 
		ТаблицаПредметыАренды.ВыгрузитьКолонку("СуммаВал"),
		ТаблицаПредметыАренды.ВыгрузитьКолонку("СуммаБезНДСВал"));
	ТаблицаПредметыАренды.ЗагрузитьКолонку(МассивСуммаВал, "СуммаВалБУ");
	
	УчетПроцентовПоОбязательствам.ПодготовитьТаблицуДокументаДляЦелейПриобретенияРеализации(
		ТаблицаПредметыАренды, Реквизиты);
	
	Запрос.УстановитьПараметр("ТаблицаПредметыАренды", ТаблицаПредметыАренды);
	
КонецПроцедуры

Функция ТаблицаКорректировкаЛизингаПараметрыАмортизацииБУ(ТаблицаОС, ТаблицаРеквизиты) Экспорт
	
	Реквизиты = ТаблицаРеквизиты[0];
	Если Не ЗначениеЗаполнено(ТаблицаОС)
		Или Не (Реквизиты.ПереходНаФСБУ25 
		И Реквизиты.Лизинг
		И Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель) Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Запрос = Новый Запрос(
		"ВЫБРАТЬ
		|	ТаблицаОС.НомерСтроки КАК НомерСтроки,
		|	ТаблицаОС.ОсновноеСредство КАК ОсновноеСредство,
		|	ТаблицаОС.ОценкаБУ КАК СтоимостьДляВычисленияАмортизации
		|ПОМЕСТИТЬ ТаблицаОС
		|ИЗ
		|	&ТаблицаОС КАК ТаблицаОС
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПараметрыАмортизацииОСБУ.ОсновноеСредство КАК ОсновноеСредство,
		|	ПараметрыАмортизацииОСБУ.СрокПолезногоИспользования КАК СрокПолезногоИспользования,
		|	ПараметрыАмортизацииОСБУ.СрокИспользованияДляВычисленияАмортизации КАК СрокИспользованияДляВычисленияАмортизации,
		|	ПараметрыАмортизацииОСБУ.ОбъемПродукцииРабот КАК ОбъемПродукцииРабот,
		|	ПараметрыАмортизацииОСБУ.ОбъемПродукцииРаботДляВычисленияАмортизации КАК ОбъемПродукцииРаботДляВычисленияАмортизации,
		|	ПараметрыАмортизацииОСБУ.КоэффициентАмортизации КАК КоэффициентАмортизации,
		|	ПараметрыАмортизацииОСБУ.КоэффициентУскорения КАК КоэффициентУскорения,
		|	ПараметрыАмортизацииОСБУ.ЛиквидационнаяСтоимость КАК ЛиквидационнаяСтоимость,
		|	ПараметрыАмортизацииОСБУ.СпособНачисленияАмортизации КАК СпособНачисленияАмортизации
		|ПОМЕСТИТЬ ПараметрыАмортизации
		|ИЗ
		|	РегистрСведений.ПараметрыАмортизацииОСБухгалтерскийУчет.СрезПоследних(
		|			&ГраницаПериода,
		|			Организация = &Организация
		|				И ОсновноеСредство В
		|					(ВЫБРАТЬ
		|						ТаблицаОС.ОсновноеСредство
		|					ИЗ
		|						ТаблицаОС КАК ТаблицаОС)) КАК ПараметрыАмортизацииОСБУ
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СостоянияОС.ОсновноеСредство КАК ОсновноеСредство,
		|	РАЗНОСТЬДАТ(СостоянияОС.ДатаСостояния, &Период, МЕСЯЦ) КАК ПрошедшийСрок
		|ПОМЕСТИТЬ ФактическоеИспользование
		|ИЗ
		|	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОС
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТаблицаОС КАК ТаблицаОС
		|		ПО (СостоянияОС.Организация = &Организация)
		|			И (СостоянияОС.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОС.ПринятоКУчету))
		|			И (ТаблицаОС.ОсновноеСредство = СостоянияОС.ОсновноеСредство)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ОсновноеСредство
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаОС.НомерСтроки КАК НомерСтроки,
		|	ТаблицаОС.ОсновноеСредство КАК ОсновноеСредство,
		|	ТаблицаОС.СтоимостьДляВычисленияАмортизации КАК СтоимостьДляВычисленияАмортизации,
		|	ПараметрыАмортизации.СрокПолезногоИспользования КАК СрокПолезногоИспользования,
		|	ПараметрыАмортизации.СрокИспользованияДляВычисленияАмортизации - ФактическоеИспользование.ПрошедшийСрок КАК СрокИспользованияДляВычисленияАмортизации,
		|	ПараметрыАмортизации.ОбъемПродукцииРабот КАК ОбъемПродукцииРабот,
		|	ПараметрыАмортизации.ОбъемПродукцииРаботДляВычисленияАмортизации КАК ОбъемПродукцииРаботДляВычисленияАмортизации,
		|	ПараметрыАмортизации.КоэффициентАмортизации КАК КоэффициентАмортизации,
		|	ПараметрыАмортизации.КоэффициентУскорения КАК КоэффициентУскорения,
		|	ПараметрыАмортизации.ЛиквидационнаяСтоимость КАК ЛиквидационнаяСтоимость,
		|	ПараметрыАмортизации.СпособНачисленияАмортизации КАК СпособНачисленияАмортизации
		|ИЗ
		|	ТаблицаОС КАК ТаблицаОС
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПараметрыАмортизации КАК ПараметрыАмортизации
		|		ПО ТаблицаОС.ОсновноеСредство = ПараметрыАмортизации.ОсновноеСредство
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ФактическоеИспользование КАК ФактическоеИспользование
		|		ПО ТаблицаОС.ОсновноеСредство = ФактическоеИспользование.ОсновноеСредство
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки");
	Запрос.УстановитьПараметр("Организация", Реквизиты.Организация);
	Запрос.УстановитьПараметр("Период", Реквизиты.Период);
	Запрос.УстановитьПараметр("ГраницаПериода",
		Новый Граница(Новый МоментВремени(Реквизиты.Период, Реквизиты.Регистратор), ВидГраницы.Исключая));
	Запрос.УстановитьПараметр("ТаблицаОС", ТаблицаОС);
	
	ТаблицаРезультат = Запрос.Выполнить().Выгрузить();
	Возврат ТаблицаРезультат;
	
КонецФункции

Функция ТекстЗапросаВременныеТаблицыДокумента(НомераТаблиц)

	НомераТаблиц.Вставить("ВременнаяТаблицаПредметыЛизинга", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ВременнаяТаблицаПредметыАренды", НомераТаблиц.Количество());
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ТаблицаПредметыЛизинга.Ссылка КАК Ссылка,
	|	ТаблицаПредметыЛизинга.НомерСтроки КАК НомерСтроки,
	|	ТаблицаПредметыЛизинга.Номенклатура КАК Номенклатура,
	|	ТаблицаПредметыЛизинга.Количество КАК Количество,
	|	ТаблицаПредметыЛизинга.Сумма КАК СуммаРуб,
	|	ТаблицаПредметыЛизинга.СуммаБезНДС КАК СуммаБезНДСРуб,
	|	ТаблицаПредметыЛизинга.НДС КАК СуммаНДСРуб,
	|	ТаблицаПредметыЛизинга.СуммаВал КАК СуммаВзаиморасчетов,
	|	ТаблицаПредметыЛизинга.НДСВал КАК СуммаНДСВзаиморасчетов,
	|	ТаблицаПредметыЛизинга.СтавкаНДС КАК СтавкаНДС,
	|	ТаблицаПредметыЛизинга.СчетУчета КАК СчетУчета,
	|	ТаблицаПредметыЛизинга.СчетУчетаНДС КАК СчетУчетаНДС,
	|	ТаблицаПредметыЛизинга.СпособУчетаНДС КАК СпособУчетаНДС
	|ПОМЕСТИТЬ ТаблицаПредметыЛизинга
	|ИЗ
	|	&ТаблицаПредметыЛизинга КАК ТаблицаПредметыЛизинга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаПредметыАренды.Ссылка КАК Ссылка,
	|	ТаблицаПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ТаблицаПредметыАренды.ПредметАренды КАК ПредметАренды,
	|	ТаблицаПредметыАренды.Сумма КАК СуммаРуб,
	|	ТаблицаПредметыАренды.СуммаБезНДС КАК СуммаБезНДСРуб,
	|	ТаблицаПредметыАренды.НДСВал КАК СуммаНДСВзаиморасчетов,
	|	ТаблицаПредметыАренды.НДС КАК СуммаНДСРуб,
	|	ТаблицаПредметыАренды.СуммаВал КАК СуммаВзаиморасчетов,
	|	ТаблицаПредметыАренды.СуммаВалБУ КАК СуммаВалБУ,
	|	ТаблицаПредметыАренды.СуммаБУ КАК СуммаБУ,
	|	ТаблицаПредметыАренды.СуммаНУ КАК СуммаНУ,
	|	ТаблицаПредметыАренды.ОценкаБУ КАК ОценкаБУ,
	|	ТаблицаПредметыАренды.СтавкаНДС КАК СтавкаНДС,
	|	ТаблицаПредметыАренды.СчетУчета КАК СчетУчета,
	|	ТаблицаПредметыАренды.СчетУчетаВнеоборотногоАктива КАК СчетУчетаВнеоборотногоАктива,
	|	ТаблицаПредметыАренды.СчетУчетаНДС КАК СчетУчетаНДС,
	|	ТаблицаПредметыАренды.СчетНачисленияАмортизации КАК СчетНачисленияАмортизации,
	|	ТаблицаПредметыАренды.СрокПолезногоИспользования КАК СрокПолезногоИспользования,
	|	ТаблицаПредметыАренды.СпособУчетаНДС КАК СпособУчетаНДС
	|ПОМЕСТИТЬ ТаблицаПредметыАренды
	|ИЗ
	|	&ТаблицаПредметыАренды КАК ТаблицаПредметыАренды";
	
	Возврат ТекстЗапроса + ОбщегоНазначенияБПВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаЗачетАвансов(ПараметрыПроведения, НомераТаблиц)
	
	НомераТаблиц.Вставить("ЗачетАвансовРеквизиты", НомераТаблиц.Количество());
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	Реквизиты.Дата КАК Период,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.ВалютаДокумента КАК ВалютаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыЗачетаАвансов.НеЗачитывать) КАК СпособЗачетаАвансов,
	|	ЛОЖЬ КАК УчитыватьЗадолженностьУСН,
	|	ЛОЖЬ КАК УчитыватьЗадолженностьУСНПатент,
	|	""Поступление"" КАК НаправлениеДвижения,
	|	ЛОЖЬ КАК ЭтоВозврат,
	|	Реквизиты.НДСВключенВСтоимость КАК НДСВключенВСтоимость
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка";
	
	ПараметрыПроведения.Вставить("ЗачетАвансовТаблицаДокумента", Неопределено);
	ПараметрыПроведения.Вставить("ЗачетАвансовТаблицаАвансов",   Неопределено);
	
	Возврат ТекстЗапроса + ОбщегоНазначенияБПВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаТаблицыДокумента(НомераТаблиц)
	
	НомераТаблиц.Вставить("ТаблицаПредметыЛизинга", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаПредметыАренды", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаПредметыАрендыПроводки", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаРублевыеСуммыДокументовВВалюте", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаПринятиеКУчетуПроводки", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаКорректировкаЛизингаПроводки", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаПринятиеКУчетуРегистрыБУ", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаПринятиеКУчетуРегистрыНУ", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ТаблицаГрафикПлатежей", НомераТаблиц.Количество());
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ПредметыЛизинга.Ссылка КАК Ссылка,
	|	""ПредметыЛизинга"" КАК ИмяСписка,
	|	ПредметыЛизинга.НомерСтроки КАК НомерСтроки,
	|	ПредметыЛизинга.Номенклатура КАК Номенклатура,
	|	ПредметыЛизинга.Количество КАК Количество,
	|	ПредметыЛизинга.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	ПредметыЛизинга.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	ПредметыЛизинга.СуммаРуб КАК СуммаРуб,
	|	ПредметыЛизинга.СуммаРуб КАК СуммаБУ,
	|	ПредметыЛизинга.СуммаРуб КАК СуммаНУ,
	|	ПредметыЛизинга.СуммаБезНДСРуб КАК СуммаБезНДСРуб,
	|	ПредметыЛизинга.СуммаНДСРуб КАК СуммаНДСРуб,
	|	ПредметыЛизинга.СчетУчета КАК СчетУчета,
	|	ПредметыЛизинга.Ссылка.СчетУчетаРасчетовСКонтрагентом КАК КорСчет,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Контрагенты) КАК ВидКорСубконто1,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Договоры) КАК ВидКорСубконто2,
	|	ПредметыЛизинга.Ссылка.Контрагент КАК КорСубконто1,
	|	ПредметыЛизинга.Ссылка.ДоговорКонтрагента КАК КорСубконто2,
	|	ПредметыЛизинга.СчетУчетаНДС КАК СчетУчетаНДС,
	|	ПредметыЛизинга.СпособУчетаНДС КАК СпособУчетаНДС,
	|	ПредметыЛизинга.СтавкаНДС КАК СтавкаНДС
	|ИЗ
	|	ТаблицаПредметыЛизинга КАК ПредметыЛизинга
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	""ПредметыАренды"" КАК ИмяСписка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.ПредметАренды КАК ОсновноеСредство,
	|	ПредметыАренды.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	ПредметыАренды.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	ПредметыАренды.СуммаРуб КАК СуммаРуб,
	|	ПредметыАренды.СуммаБУ КАК СуммаБУ,
	|	ПредметыАренды.СуммаВалБУ КАК СуммаВалБУ,
	|	ПредметыАренды.СуммаНУ КАК СуммаНУ,
	|	ПредметыАренды.СуммаБезНДСРуб КАК СуммаБезНДСРуб,
	|	ПредметыАренды.СуммаНДСРуб КАК СуммаНДСРуб,
	|	ПредметыАренды.ОценкаБУ КАК ОценкаБУ,
	|	ПредметыАренды.СчетУчета КАК СчетУчета,
	|	ПредметыАренды.СчетУчетаВнеоборотногоАктива КАК СчетУчетаВнеоборотногоАктива,
	|	ПредметыАренды.СчетУчетаНДС КАК СчетУчетаНДС,
	|	ПредметыАренды.СпособУчетаНДС КАК СпособУчетаНДС,
	|	ПредметыАренды.СтавкаНДС КАК СтавкаНДС
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.ПредметАренды КАК ОсновноеСредство,
	|	ПредметыАренды.СуммаРуб КАК СуммаРуб,
	|	ПредметыАренды.СуммаБУ КАК СуммаБУ,
	|	ПредметыАренды.СуммаВалБУ КАК СуммаВалБУ,
	|	ПредметыАренды.СуммаНДСРуб КАК СуммаНДСРуб,
	|	ПредметыАренды.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	ПредметыАренды.СчетУчета КАК СчетУчета,
	|	ПредметыАренды.СчетУчетаВнеоборотногоАктива КАК СчетУчетаВнеоборотногоАктива,
	|	ПредметыАренды.СтавкаНДС КАК СтавкаНДС,
	|	ПредметыАренды.СчетУчетаНДС КАК СчетУчетаНДС
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|ГДЕ
	|	НЕ(ПредметыАренды.Ссылка.ПереходНаФСБУ25
	|				И ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|				И ПредметыАренды.Ссылка.НалоговыйУчетИмуществаВедетЛизингополучатель)
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	""ПредметыАренды"" КАК ИмяСписка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.СуммаРуб КАК СуммаБУ,
	|	ПредметыАренды.СуммаБезНДСРуб КАК СуммаБезНДСРуб,
	|	ПредметыАренды.СуммаНДСРуб КАК СуммаНДСРуб
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.ПредметАренды КАК ОсновноеСредство,
	|	ПредметыАренды.СуммаРуб КАК СуммаРуб,
	|	ПредметыАренды.СуммаБУ КАК СуммаБУ,
	|	ПредметыАренды.СуммаНУ КАК СуммаНУ,
	|	0 КАК СуммаВР,
	|	0 КАК СуммаПР,
	|	ПредметыАренды.СчетУчета КАК СчетУчета,
	|	ПредметыАренды.СчетУчетаВнеоборотногоАктива КАК СчетУчетаВнеоборотногоАктива
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|ГДЕ
	|	ПредметыАренды.Ссылка.ПринятьКУчету
	|	И НЕ ПредметыАренды.Ссылка.ПереходНаФСБУ25
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.ПредметАренды КАК ОсновноеСредство,
	|	ПредметыАренды.СчетУчета КАК СчетУчета,
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.НалоговыйУчетИмуществаВедетЛизингополучатель
	|			ТОГДА 0
	|		ИНАЧЕ ПредметыАренды.СуммаБУ
	|	КОНЕЦ КАК СуммаБУ,
	|	ПредметыАренды.ОценкаБУ КАК ОценкаБУ
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|ГДЕ
	|	ПредметыАренды.Ссылка.ПереходНаФСБУ25
	|	И ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.ПредметАренды КАК ОсновноеСредство,
	|	ПредметыАренды.ПредметАренды.Код КАК ИнвентарныйНомер,
	|	0 КАК КоэффициентУскорения,
	|	0 КАК ОбъемПродукцииРабот,
	|	0 КАК ОбъемПродукцииРаботДляВычисленияАмортизации,
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|			ТОГДА ПредметыАренды.СрокПолезногоИспользования
	|		ИНАЧЕ (ГОД(ПредметыАренды.Ссылка.ДатаОкончанияАренды) - ГОД(ПредметыАренды.Ссылка.Дата)) * 12 + МЕСЯЦ(ПредметыАренды.Ссылка.ДатаОкончанияАренды) - МЕСЯЦ(ПредметыАренды.Ссылка.Дата)
	|	КОНЕЦ КАК СрокПолезногоИспользования,
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.ПереходНаФСБУ25
	|				И ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|			ТОГДА ПредметыАренды.ОценкаБУ
	|		ИНАЧЕ ПредметыАренды.СуммаБУ
	|	КОНЕЦ КАК СуммаБУ,
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.ПереходНаФСБУ25
	|				И ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|			ТОГДА ПредметыАренды.ОценкаБУ
	|		ИНАЧЕ ПредметыАренды.СуммаБУ
	|	КОНЕЦ КАК СтоимостьДляВычисленияАмортизации,
	|	0 КАК СуммаЗатратБУ,
	|	0 КАК СуммаЗатратНУ,
	|	0 КАК СуммаЗатратУСН,
	|	ПредметыАренды.СчетУчета КАК СчетУчета,
	|	ПредметыАренды.СчетНачисленияАмортизации КАК СчетНачисленияАмортизации,
	|	0 КАК КоэффициентАмортизации,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.Линейный) КАК СпособНачисленияАмортизации,
	|	0 КАК ЛиквидационнаяСтоимость, 
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|			ТОГДА ПредметыАренды.СрокПолезногоИспользования
	|		ИНАЧЕ (ГОД(ПредметыАренды.Ссылка.ДатаОкончанияАренды) - ГОД(ПредметыАренды.Ссылка.Дата)) * 12 + МЕСЯЦ(ПредметыАренды.Ссылка.ДатаОкончанияАренды) - МЕСЯЦ(ПредметыАренды.Ссылка.Дата)
	|	КОНЕЦ КАК СрокИспользованияДляВычисленияАмортизации
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|ГДЕ
	|	ПредметыАренды.Ссылка.ПринятьКУчету
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредметыАренды.Ссылка КАК Ссылка,
	|	ПредметыАренды.НомерСтроки КАК НомерСтроки,
	|	ПредметыАренды.ПредметАренды КАК ОсновноеСредство,
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|				И ПредметыАренды.Ссылка.НалоговыйУчетИмуществаВедетЛизингополучатель
	|			ТОГДА ПредметыАренды.СрокПолезногоИспользования
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СрокПолезногоИспользования,
	|	ВЫБОР
	|		КОГДА ПредметыАренды.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|				И ПредметыАренды.Ссылка.НалоговыйУчетИмуществаВедетЛизингополучатель
	|			ТОГДА ПредметыАренды.СуммаНУ
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СуммаНУ,
	|	0 КАК ПРДляВычисленияАмортизации,
	|	0 КАК СпециальныйКоэффициент
	|ИЗ
	|	ТаблицаПредметыАренды КАК ПредметыАренды
	|ГДЕ
	|	ПредметыАренды.Ссылка.ПринятьКУчету
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ГрафикПлатежей.НомерСтроки КАК НомерСтроки,
	|	ГрафикПлатежей.ДатаПлатежа КАК ДатаПлатежа,
	|	ГрафикПлатежей.СуммаПлатежа КАК СуммаПлатежа,
	|	ГрафикПлатежей.СуммаНДСПлатежа КАК СуммаНДСПлатежа,
	|	ВЫБОР
	|		КОГДА ГрафикПлатежей.Ссылка.НДСВключенВСтоимость
	|			ТОГДА ГрафикПлатежей.СуммаПлатежа
	|		ИНАЧЕ ГрафикПлатежей.СуммаПлатежа - ГрафикПлатежей.СуммаНДСПлатежа
	|	КОНЕЦ КАК СуммаБезНДСПлатежа
	|ИЗ
	|	Документ.ПоступлениеВАренду.ГрафикПлатежей КАК ГрафикПлатежей
	|ГДЕ
	|	ГрафикПлатежей.Ссылка = &Ссылка
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДатаПлатежа,
	|	НомерСтроки";
	
	Возврат ТекстЗапроса + ОбщегоНазначенияБПВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаПоступлениеРеквизиты(НомераТаблиц)

	НомераТаблиц.Вставить("РеквизитыПоступление", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("РеквизитыПринятиеКУчетуПроводки", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("РеквизитыПринятиеКУчетуРегистрыБУ", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("РеквизитыПринятиеКУчетуРегистрыНУ", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("РеквизитыПереходНаФСБУ25", НомераТаблиц.Количество());
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	ВЫБОР
	|		КОГДА Реквизиты.ПереходНаФСБУ25
	|			ТОГДА КОНЕЦПЕРИОДА(Реквизиты.Дата, ДЕНЬ)
	|		ИНАЧЕ Реквизиты.Дата
	|	КОНЕЦ КАК Период,
	|	Реквизиты.Номер КАК Номер,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.ВидОперации КАК ВидОперации,
	|	Реквизиты.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг) КАК Лизинг,
	|	Реквизиты.ВалютаДокумента КАК ВалютаДокумента,
	|	Реквизиты.КурсВзаиморасчетов КАК Курс,
	|	Реквизиты.КратностьВзаиморасчетов КАК Кратность,
	|	Реквизиты.НДСВключенВСтоимость КАК НДСВключенВСтоимость,
	|	Реквизиты.ПодразделениеОрганизации КАК Подразделение,
	|	Реквизиты.ПодразделениеОрганизации КАК ПодразделениеДт,
	|	Реквизиты.ПодразделениеОрганизации КАК ПодразделениеКт,
	|	Реквизиты.ПодразделениеОрганизации КАК Местонахождение,
	|	Реквизиты.Склад КАК Склад,
	|	Реквизиты.Контрагент КАК Контрагент,
	|	Реквизиты.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ЛОЖЬ КАК УчетАгентскогоНДС,
	|	ЛОЖЬ КАК ЭлектронныеУслуги,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыАгентскихДоговоров.ПустаяСсылка) КАК ВидАгентскогоДоговора,
	|	Реквизиты.СчетУчетаРасчетовСКонтрагентом КАК СчетУчетаРасчетовСКонтрагентом,
	|	Реквизиты.ДоговорКонтрагента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	ЕСТЬNULL(Реквизиты.ДоговорКонтрагента.Валютный, ЛОЖЬ) КАК РасчетыВВалюте,
	|	ЕСТЬNULL(Реквизиты.ДоговорКонтрагента.РасчетыВУсловныхЕдиницах, ЛОЖЬ) КАК РасчетыВУсловныхЕдиницах,
	|	Реквизиты.НомерВходящегоДокумента КАК НомерВходящегоДокумента,
	|	Реквизиты.ДатаВходящегоДокумента КАК ДатаВходящегоДокумента,
	|	Реквизиты.ЛизингДоФСБУ25 КАК ЛизингДоФСБУ25,
	|	Реквизиты.ПереходНаФСБУ25 КАК ПереходНаФСБУ25,
	|	Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель КАК НалоговыйУчетИмуществаВедетЛизингополучатель,
	|	Реквизиты.ДатаОкончанияАренды КАК ДатаОкончанияАренды,
	|	Реквизиты.СпособОценкиАрендыБУ КАК СпособОценкиАрендыБУ,
	|	Реквизиты.СтавкаДисконтирования КАК СтавкаДисконтирования,
	|	Реквизиты.АвансовыеПлатежи КАК АвансовыеПлатежи,
	|	Реквизиты.СтоимостьОбязательства КАК СтоимостьОбязательства,
	|	Реквизиты.ПринятьКУчету КАК ПринятьКУчету,
	|	""ПредметыАренды"" КАК ИмяСписка
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	ВЫБОР
	|		КОГДА Реквизиты.ПереходНаФСБУ25
	|			ТОГДА КОНЕЦПЕРИОДА(Реквизиты.Дата, ДЕНЬ)
	|		ИНАЧЕ Реквизиты.Дата
	|	КОНЕЦ КАК Период,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.ПодразделениеОрганизации КАК ПодразделениеДт,
	|	Реквизиты.ПодразделениеОрганизации КАК ПодразделениеКт
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	ВЫБОР
	|		КОГДА Реквизиты.ПереходНаФСБУ25
	|			ТОГДА КОНЕЦПЕРИОДА(Реквизиты.Дата, ДЕНЬ)
	|		ИНАЧЕ Реквизиты.Дата
	|	КОНЕЦ КАК Период,
	|	Реквизиты.Номер КАК Номер,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.ПодразделениеОрганизации КАК Местонахождение,
	|	Реквизиты.Контрагент КАК Контрагент,
	|	Реквизиты.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ИСТИНА КАК НачислятьАмортизацию,
	|	Реквизиты.СпособОтраженияРасходовПоАмортизации КАК СпособыОтраженияРасходовПоАмортизации,
	|	Реквизиты.МОЛ КАК МОЛ,
	|	ЗНАЧЕНИЕ(Перечисление.СостоянияОС.ПринятоКУчету) КАК СостояниеОС,
	|	&СобытиеОС КАК СобытиеОС,
	|	НЕОПРЕДЕЛЕНО КАК ПараметрВыработки,
	|	ЗНАЧЕНИЕ(Перечисление.ПорядокПогашенияСтоимостиОС.НачислениеАмортизации) КАК ПорядокПогашенияСтоимости,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыНачисленияАмортизацииОС.Линейный) КАК СпособНачисленияАмортизации,
	|	ВЫБОР
	|		КОГДА Реквизиты.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыПоступленияАктивов.ПоДоговоруЛизинга)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СпособыПоступленияАктивов.ПоДоговоруАренды)
	|	КОНЕЦ КАК СпособПоступления,
	|	""ПредметыАренды"" КАК ИмяСписка
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	ВЫБОР
	|		КОГДА Реквизиты.ПереходНаФСБУ25
	|			ТОГДА КОНЕЦПЕРИОДА(Реквизиты.Дата, ДЕНЬ)
	|		ИНАЧЕ Реквизиты.Дата
	|	КОНЕЦ КАК Период,
	|	Реквизиты.Организация КАК Организация,
	|	Реквизиты.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|		И Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель КАК НачислятьАмортизацию,
	|	ВЫБОР
	|		КОГДА Реквизиты.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|				И Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель
	|			ТОГДА Реквизиты.СпособОтраженияРасходовПоАмортизации
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК СпособыОтраженияРасходовПоАмортизации,
	|	Реквизиты.СпособОтраженияРасходовПоАренднымПлатежам КАК СпособОтраженияРасходовПоАренднымПлатежам,
	|	ИСТИНА КАК ПоступлениеВАренду,
	|	ВЫБОР
	|		КОГДА Реквизиты.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеВАренду.ПоступлениеВЛизинг)
	|				И Реквизиты.НалоговыйУчетИмуществаВедетЛизингополучатель
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокВключенияСтоимостиОСВСоставРасходовНУ.НачислениеАмортизации)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ПорядокВключенияСтоимостиОСВСоставРасходовНУ.СтоимостьНеВключаетсяВРасходы)
	|	КОНЕЦ КАК ПорядокВключенияСтоимостиВСоставРасходов,
	|	НЕОПРЕДЕЛЕНО КАК СпособОтраженияРасходовПриВключенииВСтоимость
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(Реквизиты.Дата, ГОД), СЕКУНДА, 1) КАК Период,
	|	Реквизиты.Организация КАК Организация,
	|	"""" КАК ИмяСписка
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка";

	Возврат ТекстЗапроса + ОбщегоНазначенияБПВызовСервера.ТекстРазделителяЗапросовПакета();

КонецФункции

Функция ТекстЗапросаПереоценкаВалютныхОстатков(НомераТаблиц)

	НомераТаблиц.Вставить("ПереоценкаВалютныхОстатковРеквизиты", НомераТаблиц.Количество());
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Реквизиты.Ссылка КАК Регистратор,
	|	Реквизиты.Дата КАК Период,
	|	Реквизиты.Организация,
	|	Реквизиты.ВалютаДокумента
	|ИЗ
	|	Документ.ПоступлениеВАренду КАК Реквизиты
	|ГДЕ
	|	Реквизиты.Ссылка = &Ссылка";

	Возврат ТекстЗапроса + ОбщегоНазначенияБПВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

#КонецОбласти

#КонецЕсли