#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
Процедура ЗаполнениеПоОснованию(Объект, ДанныеЗаполнения, Сумма = Неопределено, Отказ = Ложь, ОтборПоПериоду = Неопределено) Экспорт 
	
	//1c-izhtc spawn 07.08.15 (
	//Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.бит_БК_РазнесениеОборотов") Тогда
	//	
	//	рс_ОбщийМодуль.ЗаполнитьШапкуДокумента(Объект, Объект.Ссылка.Метаданные(), ПользователиКлиентСервер.ТекущийПользователь());
	//	Объект.ВидОперации 			= Перечисления.рс_ВидыОперацийАккруалПоID.ПоРО;
	//	
	//	Объект.Организация 			= ДанныеЗаполнения.Организация;
	//	Объект.Контрагент 			= ДанныеЗаполнения.Контрагент;
	//	//ОК+ Аверьянова 26.01.15 по заявке Пелеевой Г.
	//	//Объект.ДоговорКонтрагента	= Объект.Контрагент.ОсновнойДоговорКонтрагента;
	//	Объект.ДоговорКонтрагента	= ДанныеЗаполнения.СБ_ДоговорКонтрагента;
	//	//ОК- Аверьянова 26.01.15 #AT-1236890# от 20.01.15
	//	Объект.Комментарий 			= ДанныеЗаполнения.Комментарий;
	//	Объект.ID 					= ДанныеЗаполнения.ID_Разнесения;
	//	Объект.ДокументОснование 	= ДанныеЗаполнения.Ссылка;
	//	
	//	Объект.База.Очистить();
	//
	//	Для Каждого ТекСтрокаУправленческаяАналитика Из ДанныеЗаполнения.УправленческаяАналитика Цикл
	//		// Rarus-spb byse 2012.02.25 Распределение по периодам, задача 157 {
	//		Если ОтборПоПериоду <> Неопределено И НачалоМесяца(ТекСтрокаУправленческаяАналитика.Период) <> ОтборПоПериоду Тогда
	//			Продолжить;
	//		КонецЕсли;	
	//		// Rarus-spb byse 2012.02.25 Распределение по периодам, задача 157 }
	//		
	//		НоваяСтрока = Объект.База.Добавить();
	//		НоваяСтрока.Период 				= ТекСтрокаУправленческаяАналитика.Период;
	//		НоваяСтрока.Объект 				= ТекСтрокаУправленческаяАналитика.Аналитика_2;
	//		НоваяСтрока.ФункцияЦФО 			= ТекСтрокаУправленческаяАналитика.ЦФО;
	//		//НоваяСтрока.СтатьяОборотов	= ТекСтрокаУправленческаяАналитика.СтатьяОборотов;
	//		НоваяСтрока.Счет 				= рс_ОбщийМодуль.ПолучитьСчетМСФОПоСтатьеОборотов(ТекСтрокаУправленческаяАналитика.СтатьяОборотов);
	//		Если НЕ ЗначениеЗаполнено(НоваяСтрока.Счет) Тогда
	//			Отказ = Истина;
	//		КонецЕсли;
	//		НоваяСтрока.СчетНаименование 	= НоваяСтрока.Счет.Наименование;
	//		НоваяСтрока.Сумма 				= ?(Сумма <> Неопределено, Сумма, ТекСтрокаУправленческаяАналитика.СуммаБезНДС);
	//		
	//	КонецЦикла;
	//	
	//ИначеЕсли ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.рс_ЗаявкаНаДоговор") Тогда
	Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.рс_ЗаявкаНаДоговор") Тогда
	//1c-izhtc spawn 07.08.15 )
		
		рс_ОбщийМодуль.ЗаполнитьШапкуДокумента(Объект, Объект.Ссылка.Метаданные(), ПользователиКлиентСервер.ТекущийПользователь());
		
		ЗаполнитьЗначенияСвойств(Объект, ДанныеЗаполнения, , "Номер, Дата, Ответственный");
		
		Объект.ВидОперации 			= Перечисления.рс_ВидыОперацийАккруалПоID.ПоЗаявкеНаДоговор;
		Объект.ДокументОснование 	= ДанныеЗаполнения.Ссылка;
		
		//ОКЕЙ Первухин В.С. (ПервыйБИТ) Начало 2020-01-15 (#НТП_БП03_ФР04) 
		Объект.ок_ВалютаДокумента	=	Объект.ДокументОснование.ДоговорКонтрагента.ВалютаВзаиморасчетов;
		
		ВалютаРегламентированногоУчета	=	Константы.ВалютаРегламентированногоУчета.Получить();
		СтруктураКурсаРегл				=	РаботаСКурсамиВалют.ПолучитьКурсВалюты(ВалютаРегламентированногоУчета, Объект.Дата);
		
		Если ЗначениеЗаполнено(Объект.ок_ВалютаДокумента) И Не Объект.ок_ВалютаДокумента = ВалютаРегламентированногоУчета Тогда
			ок_УстановитьКурсВзаиморасчетов(Объект);
		КонецЕсли;
		//ОКЕЙ Первухин В.С. (ПервыйБИТ) Конец 2020-01-15 (#НТП_БП03_ФР04)
		
		Объект.База.Очистить();
		
	 // Rarus-spb byse {
		СуммаМакс = 0;
		
		Для Каждого СтрокаТЧ Из ДанныеЗаполнения.База Цикл
			// Rarus-spb byse 2012.02.25 Распределение по периодам, задача 157 {
			Если ОтборПоПериоду <> Неопределено И НачалоМесяца(СтрокаТЧ.Период) <> ОтборПоПериоду Тогда
				Продолжить;
			КонецЕсли;	
			// Rarus-spb byse 2012.02.25 Распределение по периодам, задача 157 }
		
			НоваяСтрока = Объект.База.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЧ);
			
			НоваяСтрока.Счет = рс_ОбщийМодуль.ПолучитьСчетМСФОПоСтатьеОборотов(СтрокаТЧ.СтатьяОборотов);
			
			Если Сумма <> Неопределено И Сумма <> 0 Тогда
				Коэф = Сумма / ДанныеЗаполнения.База.Итог("СуммаБезНДС");
			Иначе
				Коэф = 1;
			КонецЕсли;	 
			
			Если НЕ ЗначениеЗаполнено(НоваяСтрока.Счет) Тогда
				Отказ = Истина;
			КонецЕсли;
			НоваяСтрока.СчетНаименование 	= НоваяСтрока.Счет.Наименование;
			НоваяСтрока.Сумма 				= СтрокаТЧ.СуммаБезНДС * Коэф;
			
			СуммаМакс = Макс(НоваяСтрока.Сумма,СуммаМакс);
			//ОКЕЙ Первухин В.С. (ПервыйБИТ) Начало 2020-01-15 (#НТП_БП03_ФР04) 
			Если ЗначениеЗаполнено(Объект.ок_ВалютаДокумента) И Не Объект.ок_ВалютаДокумента = ВалютаРегламентированногоУчета Тогда
				ок_РассчитатьСуммуРеглСтрокиТабличнойЧасти(Объект, НоваяСтрока, ВалютаРегламентированногоУчета, 
					СтруктураКурсаРегл.Курс, СтруктураКурсаРегл.Кратность);
			КонецЕсли;
			//ОКЕЙ Первухин В.С. (ПервыйБИТ) Конец 2020-01-15 (#НТП_БП03_ФР04)
		КонецЦикла;	
		
		Если Сумма <> Неопределено И Сумма <> 0 И Сумма <> Объект.База.Итог("Сумма") Тогда
			Разница             = Сумма - Объект.База.Итог("Сумма");
			ИскомаяСтрока       = Объект.База.Найти(СуммаМакс,"Сумма");
			ИскомаяСтрока.Сумма = ИскомаяСтрока.Сумма + Разница;
			
			//ОКЕЙ Первухин В.С. (ПервыйБИТ) Начало 2020-01-15 (#НТП_БП03_ФР04) 
			Если ЗначениеЗаполнено(Объект.ок_ВалютаДокумента) И Не Объект.ок_ВалютаДокумента = ВалютаРегламентированногоУчета Тогда
				ок_РассчитатьСуммуРеглСтрокиТабличнойЧасти(Объект, ИскомаяСтрока, ВалютаРегламентированногоУчета, 
					СтруктураКурсаРегл.Курс, СтруктураКурсаРегл.Кратность);
			КонецЕсли;
			//ОКЕЙ Первухин В.С. (ПервыйБИТ) Конец 2020-01-15 (#НТП_БП03_ФР04)
		КонецЕсли;	 
	// Rarus-spb byse }
		
	// Rarus-spb byse 2012.02.25 Распределение по периодам, задача 157 {
	ИначеЕсли ТипЗнч(ДанныеЗаполнения) = Тип ("Структура") Тогда
		ЗаполнитьЗначенияСвойств(Объект,ДанныеЗаполнения);
		
		мБаза = "";
		Если ДанныеЗаполнения.Свойство("База",мБаза) Тогда
			Объект.База.Загрузить(ПолучитьИзВременногоХранилища(мБаза));
		КонецЕсли;	
	// Rarus-spb byse 2012.02.25 }
	КонецЕсли;
	
	Объект.РассчитатьСуммуДокумента();
	
КонецПроцедуры

//ОКЕЙ Первухин В.С. (ПервыйБИТ) Начало 2020-01-15 (#НТП_БП03_ФР04)

Процедура ок_УстановитьКурсВзаиморасчетов(Объект) Экспорт
	
	СтруктураКурса	=	РаботаСКурсамиВалют.ПолучитьКурсВалюты(Объект.ок_ВалютаДокумента, Объект.Дата);
	СтруктураКурса.Свойство("Курс",			Объект.ок_КурсВзаиморасчетов);
	СтруктураКурса.Свойство("Кратность",	Объект.ок_КратностьВзаиморасчетов);
	
КонецПроцедуры

Процедура ок_РассчитатьСуммуРеглСтрокиТабличнойЧасти(Объект, СтрокаТабличнойЧасти, Валюта, Курс, Кратность) Экспорт
	
	СтрокаТабличнойЧасти.ок_СуммаРегл = РаботаСКурсамиВалютБПКлиентСервер.ПересчитатьИзВалютыВВалюту(
											СтрокаТабличнойЧасти.Сумма, Объект.ок_ВалютаДокумента, Валюта, Объект.ок_КурсВзаиморасчетов,
											Курс, Объект.ок_КратностьВзаиморасчетов, Кратность);
							
КонецПроцедуры

//ОКЕЙ Первухин В.С. (ПервыйБИТ) Конец 2020-01-15 (#НТП_БП03_ФР04)

#КонецЕсли