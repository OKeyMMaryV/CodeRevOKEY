//ОКЕЙ Лобанов В.И.(СофтЛаб) Начало 2019-01-11 (#3155)
//ОКЕЙ Наумов А.Н.(СофтЛаб) Начало 2019-04-11 (#3325)
//Процедура ТранслироватьВБК(МассивДокументов) Экспорт
Функция ТранслироватьВБК(Знач МассивДокументов) Экспорт
//ОКЕЙ Наумов А.Н.(СофтЛаб) Конец 2019-04-11 (#3325)
		
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ВыбранныеОперации"	,	МассивДокументов);
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	бит_ДополнительныеДанныеПоОперациямАксапты.Документ КАК Ссылка
	|ИЗ
	|	РегистрСведений.бит_ДополнительныеДанныеПоОперациямАксапты КАК бит_ДополнительныеДанныеПоОперациямАксапты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Хозрасчетный КАК Хозрасчетный
	|		ПО бит_ДополнительныеДанныеПоОперациямАксапты.Документ = Хозрасчетный.Регистратор
	|			И (Хозрасчетный.Активность = ИСТИНА)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.бит_ОборотыПоБюджетам КАК бит_ОборотыПоБюджетам
	|		ПО бит_ДополнительныеДанныеПоОперациямАксапты.Документ = бит_ОборотыПоБюджетам.Регистратор
	|ГДЕ
	|	бит_ОборотыПоБюджетам.Регистратор ЕСТЬ NULL
	|	И бит_ДополнительныеДанныеПоОперациямАксапты.Документ В(&ВыбранныеОперации)
	|	И бит_ДополнительныеДанныеПоОперациямАксапты.Документ.Проведен
	|
	|СГРУППИРОВАТЬ ПО
	|	бит_ДополнительныеДанныеПоОперациямАксапты.Документ";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда 
		//ОКЕЙ Наумов А.Н.(СофтЛаб) Начало 2019-04-11 (#3325)
		//Возврат;
		Возврат Ложь;
		//ОКЕЙ Наумов А.Н.(СофтЛаб) Конец 2019-04-11 (#3325)
	КонецЕсли;
	
	МассивИсточники = Новый Массив;
	Источник = Справочники.бит_ОбъектыСистемы.НайтиПоРеквизиту("ИмяОбъектаПолное","РегистрНакопления.бит_ок_ОборотыАксапты");
	Если ЗначениеЗаполнено(Источник) Тогда
		МассивИсточники.Добавить(Источник);
	КонецЕсли;
	МассивПриемники = Новый Массив;
	Приемник = Справочники.бит_ОбъектыСистемы.НайтиПоРеквизиту("ИмяОбъектаПолное","РегистрНакопления.бит_ОборотыПоБюджетам");
	Если ЗначениеЗаполнено(Приемник) Тогда
		МассивПриемники.Добавить(Приемник);
	КонецЕсли;
	Приемник = Справочники.бит_ОбъектыСистемы.НайтиПоРеквизиту("ИмяОбъектаПолное","РегистрНакопления.бит_КонтрольныеЗначенияБюджетов");
	Если ЗначениеЗаполнено(Приемник) Тогда
		МассивПриемники.Добавить(Приемник);
	КонецЕсли;
		
	ОК_ОбщегоНазначения.ВыполнитьТрансляциюОперацийАксаптыВРегистрыБК(РезультатЗапроса.Выгрузить().ВыгрузитьКолонку("Ссылка"), МассивИсточники, МассивПриемники);
		
//ОКЕЙ Наумов А.Н.(СофтЛаб) Начало 2019-04-11 (#3325)
	Возврат Истина;
//КонецПроцедуры
КонецФункции
//ОКЕЙ Наумов А.Н.(СофтЛаб) Начало 2019-04-11 (#3325)
//ОКЕЙ Лобанов В.И.(СофтЛаб) Конец 2019-01-11 (#3155)

//ОКЕЙ Лобанов В.И.(СофтЛаб) Начало 2019-04-04 (#3124,3267)
Функция ПолучитьСвязаннуюОперациюБУХ(СторнируемыйДокумент) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	|	ОперацияБух.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ОперацияБух КАК ОперацияБух
	|ГДЕ
	//ОКЕЙ Лобанов В.И.(СофтЛаб) Начало 2019-08-15 (#3124)
	|	НЕ ОперацияБух.ПометкаУдаления
	|	И
	//ОКЕЙ Лобанов В.И.(СофтЛаб) Конец 2019-08-15 (#3124)
	|	ОперацияБух.СторнируемыйДокумент = &СторнируемыйДокумент";
	
	Запрос.УстановитьПараметр("СторнируемыйДокумент", СторнируемыйДокумент);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Если ВыборкаДетальныеЗаписи.Следующий() Тогда 
		
		Возврат ВыборкаДетальныеЗаписи.Ссылка;
			
	КонецЕсли;
	
	Возврат ПредопределенноеЗначение("Документ.ОперацияБух.ПустаяСсылка");
	
	
КонецФункции
//ОКЕЙ Лобанов В.И.(СофтЛаб) Конец 2019-04-04 (#3124,3267)
