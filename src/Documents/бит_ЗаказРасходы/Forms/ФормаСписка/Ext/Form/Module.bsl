Перем мКэшЗначений Экспорт;

&НаСервере
//ОКЕЙ Поздняков А.С. (СофтЛаб) Начало 2020-10-22 (#3926)
//Процедура УстановитьПараметрСеансаТекущийИнициатор(DomainName,КэшированныеЗначения)
Процедура УстановитьПараметрСеансаТекущийИнициатор(КэшированныеЗначения)
//ОКЕЙ Поздняков А.С. (СофтЛаб) Конец 2020-10-22 (#3926)
	//определяем текущего инициатора, если не определим завершим работу
	КэшИнициатора = Новый Структура;

	//ОКЕЙ Поздняков А.С. (СофтЛаб) Начало 2020-10-22 (#3926)
	//ПараметрыСеанса.бит_БК_ТекущийИнициатор = Справочники.бит_БК_Инициаторы.НайтиПоРеквизиту("DomainName",DomainName);
	СтандартныеПодсистемыВызовСервера.УстановитьПараметрСеансаТекущийИнициатор();
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Конец 2020-10-22 (#3926)
	
	КэшИнициатора.Вставить("ПустойИнициатор", Справочники.бит_БК_Инициаторы.ПустаяСсылка());
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Начало 2020-10-22 (#3926)
	//КэшИнициатора.Вставить("DomainName",DomainName);
	КэшИнициатора.Вставить("DomainName", ПараметрыСеанса.бит_БК_ТекущийИнициатор.DomainName);
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Конец 2020-10-22 (#3926)
	КэшИнициатора.Вставить("ТекущийИнициатор", ПараметрыСеанса.бит_БК_ТекущийИнициатор);
	
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Начало 2020-05-18 (#3750)
	////ОК Калинин М. 130813
	//КэшИнициатора.Вставить("ИспользуемаяФорма", ПараметрыСеанса.бит_БК_ТекущийИнициатор.ИспользуемаяФорма);
	////ОК Калинин М. 
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Конец 2020-05-18 (#3750)
	
	//СписокОтбораИнициатора = Новый СписокЗначений;
	//ТекИнициаторСписка = ПараметрыСеанса.бит_БК_ТекущийИнициатор;
	
	//Пока Истина Цикл
	//	ПодИнициатором = Справочники.бит_БК_Инициаторы.НайтиПоРеквизиту("Руководитель",ТекИнициаторСписка.Наименование);
	//	Если ПодИнициатором.Пустая() Тогда
	//		Прервать;
	//	КонецЕсли;
	//	
	//	Если СписокОтбораИнициатора.НайтиПоЗначению(ПодИнициатором) = Неопределено Тогда
	//		СписокОтбораИнициатора.Добавить(ПодИнициатором);
	//	Иначе 
	//		Прервать;
	//	КонецЕсли;
	//	
	//	ТекИнициаторСписка = ПодИнициатором;
	//КонецЦикла;
	
	//СписокОтбораИнициатора.Добавить(ПараметрыСеанса.бит_БК_ТекущийИнициатор);
	//КэшИнициатора.Вставить("СписокОтбораИнициатора",СписокОтбораИнициатора);
	
	КэшированныеЗначения.Вставить("Инициатор",КэшИнициатора);	
КонецПроцедуры

&НаКлиенте
Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ПоказатьЗначение(Неопределено, Элемент.ТекущиеДанные.Ссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Начало 2020-10-22 (#3926)
	//DomainName = ПолучитьДоменноеИмяПользователя();
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Конец 2020-10-22 (#3926)
	//на сервере
	мКэшЗначений = Новый Структура;
	
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Начало 2020-10-22 (#3926)
	//УстановитьПараметрСеансаТекущийИнициатор(DomainName, мКэшЗначений);
	УстановитьПараметрСеансаТекущийИнициатор(мКэшЗначений);
	//ОКЕЙ Поздняков А.С. (СофтЛаб) Конец 2020-10-22 (#3926)

КонецПроцедуры

&НаКлиенте
Функция ПолучитьДоменноеИмяПользователя()
	oNet = Новый COMОбъект("WScript.Network");
	DomainName = СокрЛП(""+oNet.UserDomain+"\"+oNet.UserName);
    Возврат DomainName;
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
КонецПроцедуры


мКэшЗначений = Неопределено;