
&НаКлиенте
Процедура Перенести(Команда)
	
	Если СуммаКРаспределению < 0 Тогда
		Сообщить("Сумма строк к переносу не может превышать сумму исходной разбиваемой строки!");
		Возврат;
	КонецЕсли;
	
	ЭтаФорма.Закрыть(Товары);
	
КонецПроцедуры

&НаКлиенте
Процедура Пересчитать()
	
	СуммаКРаспределению = СуммаВсего;
	
	Для Каждого Стр Из Товары Цикл
		СуммаКРаспределению = СуммаКРаспределению - Стр.Сумма;			
	КонецЦикла;
		
КонецПроцедуры


&НаСервере
Процедура ПересчитатьНаСервере()
	
	СуммаКРаспределению = СуммаВсего;
	
	Для Каждого Стр Из Товары Цикл
		СуммаКРаспределению = СуммаКРаспределению - Стр.Сумма;			
	КонецЦикла;
		
КонецПроцедуры


&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	
	Строка = Товары.Добавить();
	Строка.Номенклатура			= Параметры.Номенклатура;
	Строка.Количество			= Параметры.Количество;
	Строка.Цена					= Параметры.Цена;
	Строка.Сумма				= Параметры.Сумма;
	Строка.СтавкаНДС			= Параметры.СтавкаНДС;
	Строка.СуммаНДС				= Параметры.СуммаНДС;
	Строка.СчетУчета			= Параметры.СчетУчета;
	Строка.СчетУчетаНДС			= Параметры.СчетУчетаНДС;
	
	СуммаВсего = Товары[0].Сумма;
	
	ПересчитатьНаСервере();
	
	
КонецПроцедуры


&НаКлиенте
Процедура ТоварыПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
		Пересчитать();
КонецПроцедуры


&НаКлиенте
Процедура ТоварыПослеУдаления(Элемент)
		Пересчитать();
КонецПроцедуры


&НаКлиенте
Процедура ТоварыПриИзменении(Элемент)
		Пересчитать();
КонецПроцедуры


&НаКлиенте
Процедура ТоварыПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
		Пересчитать();
КонецПроцедуры


&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)
	
	СтрокаТаблицы = Элементы.Товары.ТекущиеДанные;
	ОбработкаТабличныхЧастейКлиентСервер.РассчитатьСуммуТабЧасти(СтрокаТаблицы, 0);
	ОбработкаТабличныхЧастейКлиентСервер.РассчитатьСуммуНДСТабЧасти(СтрокаТаблицы, Истина, Ложь);

КонецПроцедуры


&НаКлиенте
Процедура ТоварыЦенаПриИзменении(Элемент)
	
	СтрокаТаблицы = Элементы.Товары.ТекущиеДанные;
	ОбработкаТабличныхЧастейКлиентСервер.РассчитатьСуммуТабЧасти(СтрокаТаблицы, 0);
	ОбработкаТабличныхЧастейКлиентСервер.РассчитатьСуммуНДСТабЧасти(СтрокаТаблицы, Истина, Ложь);
	
КонецПроцедуры


&НаКлиенте
Процедура ТоварыСуммаПриИзменении(Элемент)
	
	СтрокаТаблицы = Элементы.Товары.ТекущиеДанные;
	
		Если (СтрокаТаблицы.Количество = 0) Тогда
			СтрокаТаблицы.Цена = 0;
		Иначе
			СтрокаТаблицы.Цена = СтрокаТаблицы.Сумма / ?(СтрокаТаблицы.Количество = 0, 0, СтрокаТаблицы.Количество);
		КонецЕсли;

КонецПроцедуры

